### https中的身份认证

https是在http的基础上，增加了SSL/TLS来加密数据包的超文本安全传输协议。https开发的主要目的，是提供对网站服务器的身份认证，保护交换资料的隐私与完整性。

那么https是如何确认网站服务器的身份，确保正在连接的服务器就是正确的服务器呢？

网站在实现https服务支持时，需要先申请一个SSL证书，也叫服务器证书，它是数字证书的一种。这个证书就是网站服务器的电子身份，通过验证证书就可以对服务器进行身份认证。

数字证书又是什么呢

数字证书在wiki中叫公开密钥认证，也叫身份证书，是用于公开密基础建设的电子文件，用来证明公开密钥拥有者的身份。数字证书通过认证中心来担保公开密钥的制作者。到这里是不是有点懵了，说身份认证呢怎么又是数字证书，又是公开密钥，这些都有什么关系呢。其实是https在安全传输的过程中，用到了对称加密和非对称加密的混合加密方式，而非对称加密的公钥存在无法确认其制作者身份的问题，这也就是数字证书要解决的问题。

我们来看看如何申请和验证一个数字证书，来看数字证书如何验证身份的

数字证书通常都是信任链，也叫数字证书链，是一连串的数字证书，由根证书为起点，通过重重信任，使终端实体证书的持有者可以获得转授的信任，以证明身份。

申请过程
01. 公司A在自己的机器上使用密码学安全伪随机数生成器产生一对足够强的密钥，公司A的私钥不会向任何人发送
02. 公司A把它的公钥，连同主体消息、使用目的等组成证书签署请求(具体因证书类型和CA不同而不同)，发送给认证机构B
    证书签署请求CSR中包含三部分：
        the certification request information(including public key)
        a signature algorithm identifier
        a digital signature(by the requester) on the certification request information
    * 比如阿里上申请OV证书，需要填写域名名称、证书类型、证书品牌、联系人(邮箱、手机号等)、公司(名称、电话、地址、营业执照等)、营业执照、CSR生成方式、CSR生成内容
03. 认证机构B(用另外一些渠道)核实公司A的身份
    * 比如CA将向联系人邮箱发送一封域名验证邮件
04. 如果认证机构B信任这个请求，它便使用公司A的公钥和主体消息，加上证书的有效期、用途等限制条件，组成证书的基本资料
05. 认证机构B用自己的私钥对公司A的公钥加上数字签名并生成证书
06. 认证机构B把生成的证书发给公司A
07. 公司A将签发的证书安装到机器上

假设公司A的数字证书链是：R-B-A，那么验证过程如下：
01. 浏览器C访问公司A的机器
02. 公司A将自己的证书发送给浏览器C
03. 浏览器C开始对证书进行的验证(公钥算法和参数检查、是否在有效期、是否被吊销、发行者名是否和上级证书主题名一致、命名策略基本限制检查、路径长度、任何其他重要扩展识别)
    * 浏览器先验证A证书
    * 再检查其上级签发证书即B证书
    * 再验证B证书的上级证书即R证书，因为R证书没有再上级签发机构，它是自签证书。浏览器C会检查此证书有否已预载于根证书清单上：若有，则证书A确认有效，公司A的服务器被认为可信任；否则向用户警告网站未获信任
04. 根据证书验证结果，进行后续操作

数字证书已在TLS实现并在HTTPS、SMTPS广泛应用。这就是https来验证网站服务器身份的实现细节，确保通信双方不会被冒充。